<html>
	<head> 
		<title>Session Log</title>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css"> <!-- load bootstrap css -->
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css"> <!-- load fontawesome -->
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
		<script type="text/javascript" src='/javascripts/socket.io.min.js'></script>    
		<script type="text/javascript" src='/javascripts/jquery-1.9.1.min.js'></script>    
		<script type="text/javascript" src='/javascripts/index.js'></script>    

		
		<script type="text/javascript">

			function loadMap(locationsArray) 
			{
				//console.log("check it: "+locationsArray[0].timeStamp);
				var centerLong;
				var centerLat
				if(locationsArray.length)
				{
					centerLat = locationsArray[locationsArray.length-1].latitude;
					centerLong = locationsArray[locationsArray.length-1].longitude;
				}
				else
				{
					centerLat = 33.775509;
					centerLong = -84.396379;
				}

				var myOptions = {

				  center: new google.maps.LatLng(centerLat, centerLong),
				  zoom: 13,
				  mapTypeId: google.maps.MapTypeId.ROADMAP
				};
				map = new google.maps.Map(document.getElementById("map"),
					myOptions);	

				

				var myMarker, i;
				for( i = 0; i < locationsArray.length; i++)
				{
					marker = new google.maps.Marker({
					position: new google.maps.LatLng(locationsArray[i].latitude, locationsArray[i].longitude), // Example Lat/Long
					map: map, // references the map object you defined earlier
					title: locationsArray[i].timeStamp.toString() // a title that will appear on hover
	    			});
				} 	

				var results = '<table class="table table-striped table-bordered table-condensed text-center" class ="fa" style="width: 1000px;">';
				results += '<th class = "text-center">Time Stamp</th>';
				results += '<th class = "text-center">Latitude</th>';
				results += '<th class = "text-center">Longitude</th>';
	            for (var i=0; i<locationsArray.length; i++) { //###NOTICE THE CHANGE FROM i++ TO     i=i+2               
	                results += "<tr><td>" + locationsArray[i].timeStamp + "</td>";  
	                results += "<td>" + locationsArray[i].latitude + "</td>";
	                results += "<td>" + locationsArray[i].longitude + "</td>";
	                results += "</tr>";   
	                }
	            
	            results += "</table>";
	         	var div = document.getElementById("Table");
	        	div.innerHTML = results;	
			}
			function initializeLocations(){
		      var pathArray = window.location.href.split( '/' );
		      var pathCreated = window.location.origin+"/getLocationsArrayForSession/"+pathArray[pathArray.length-1];
		      console.log(pathCreated);
		      // console.log(window.location.origin+"/getLocationsArrayForSession/"+pathArray[pathArray.length-1]);
		       $.get(pathCreated,function(data,status){
		         //alert("Data: " + data + "\nStatus: " + status);
		         //console.log(data[0].latitude);
		         loadMap(data);
		      });
			}
			window.onload= initializeLocations;
		</script>
		
	</head>
	<body>
		<div class = "container">
			<div class="col-sm-6 col-sm-offset-4">
				<h1><span class="fa"></span> <%= session.session.email %>'s Session</h1>
			</div>
			<div id="map" style="width:1000px;height:300px;"></div>

			<div><span class="fa"></span>
				<b>Start Date: <%= session.session.startDate %></b>
			</div>
			<div><span class="fa"></span>
				<b>End Date: <%= session.session.endDate %></b>
			</div>
			<div><span class="fa"></span>
				<b>Guardian: <%= session.session.guardianContact.email %></b>
			</div>

			<div id="Table"></div>
		</div>

<!-- 		<button onclick="loadMap(locationsArray)">Try it</button>
 -->	</body>
</html>
